{% comment %} 
  LEADERBOARD V8: OLYMPUS GLORY STYLE
  Features: Top 3 Podium + Animated Avatars + Class Icons
{% endcomment %}

<div class="leaderboard-olympus-wrapper">
  <!-- Background FX -->
  <div class="olympus-bg"></div>
  <div class="god-rays"></div>

  <div class="leaderboard-content">
    
    <!-- HEADER -->
    <div class="lb-header">
      <h2 class="lb-title">HALL OF LEGENDS</h2>
      <div class="season-timer">
        <span>SEASON ENDS IN:</span>
        <span id="season-countdown" class="timer-val">Loading...</span>
      </div>
    </div>

    <!-- KHU V·ª∞C TOP 3 (PODIUM) -->
    <div class="podium-stage" id="podium-render">
      <!-- JS s·∫Ω v·∫Ω Top 1, 2, 3 v√†o ƒë√¢y -->
      <div class="loading-state">SUMMONING CHAMPIONS...</div>
    </div>

    <!-- DANH S√ÅCH TOP 4-10 -->
    <div class="ranking-list" id="ranking-list-render">
      <!-- JS s·∫Ω v·∫Ω Top 4+ v√†o ƒë√¢y -->
    </div>

  </div>
</div>

<style>
  /* --- 1. CORE LAYOUT --- */
  .leaderboard-olympus-wrapper {
    width: 100vw !important; position: relative; left: 50%; transform: translateX(-50%);
    background-color: #050505; color: #fff; padding: 80px 0;
    font-family: 'Cinzel', serif; overflow: hidden;
  }

  .olympus-bg {
    position: absolute; inset: 0; z-index: 0;
    background: radial-gradient(circle at 50% 10%, #1a1000 0%, #000 80%);
  }

  .god-rays {
    position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    width: 100%; height: 500px;
    background: conic-gradient(from 180deg at 50% 0%, transparent 0deg, rgba(255, 215, 0, 0.1) 20deg, transparent 40deg);
    filter: blur(20px); pointer-events: none;
  }

  .leaderboard-content { position: relative; z-index: 2; max-width: 1000px; margin: 0 auto; padding: 0 20px; }

  /* --- 2. HEADER --- */
  .lb-title {
    text-align: center; font-size: 3rem; margin: 0 0 10px 0;
    color: transparent; background: linear-gradient(to bottom, #ffd700, #b8860b);
    -webkit-background-clip: text; text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    letter-spacing: 5px; font-weight: 800;
  }
  
  .season-timer {
    text-align: center; font-family: 'Roboto', sans-serif; color: #888; font-size: 0.9rem;
    background: rgba(255,255,255,0.05); display: inline-block;
    padding: 5px 20px; border-radius: 20px; border: 1px solid #333;
    position: relative; left: 50%; transform: translateX(-50%); margin-bottom: 50px;
  }
  .timer-val { color: #ff4d4d; font-weight: bold; margin-left: 5px; }

  /* --- 3. PODIUM (TOP 3) --- */
  .podium-stage {
    display: flex; justify-content: center; align-items: flex-end; gap: 20px;
    margin-bottom: 60px; min-height: 350px;
  }

  .podium-card {
    position: relative; text-align: center; width: 220px;
    transition: transform 0.3s;
  }
  .podium-card:hover { transform: translateY(-10px); }

  /* Th·ª© t·ª± hi·ªÉn th·ªã: 2 - 1 - 3 */
  .podium-card.rank-1 { order: 2; z-index: 10; transform: scale(1.1); margin-bottom: 20px; }
  .podium-card.rank-2 { order: 1; }
  .podium-card.rank-3 { order: 3; }

  /* Avatar */
  .p-avatar-frame {
    width: 100px; height: 100px; margin: 0 auto 15px; position: relative;
  }
  .p-avatar {
    width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
    border: 3px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  
  /* Khung vi·ªÅn Avatar theo Rank */
  .rank-1 .p-avatar { border-color: #ffd700; box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
  .rank-2 .p-avatar { border-color: #c0c0c0; box-shadow: 0 0 20px rgba(192, 192, 192, 0.3); }
  .rank-3 .p-avatar { border-color: #cd7f32; box-shadow: 0 0 20px rgba(205, 127, 50, 0.3); }

  /* V∆∞∆°ng mi·ªán Top 1 */
  .crown-icon {
    position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
    font-size: 40px; filter: drop-shadow(0 0 10px gold); animation: floatCrown 2s infinite ease-in-out;
  }
  @keyframes floatCrown { 0%,100%{transform:translateX(-50%) translateY(0);} 50%{transform:translateX(-50%) translateY(-5px);} }

  /* Th√¥ng tin Podium */
  .p-name { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; color: #fff; }
  .rank-1 .p-name { color: #ffd700; font-size: 1.4rem; text-shadow: 0 0 10px #ffd700; }
  
  .p-class { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; background: #222; display: inline-block; margin-bottom: 5px; }
  .class-warrior { color: #ff4d4d; border: 1px solid #ff4d4d; }
  .class-mage { color: #a335ee; border: 1px solid #a335ee; }
  .class-archer { color: #2ecc71; border: 1px solid #2ecc71; }

  .p-score { font-family: 'Roboto', sans-serif; font-weight: bold; font-size: 1.1rem; color: #ddd; }
  .p-reward { font-size: 0.8rem; color: #ffd700; margin-top: 5px; }

  /* B·ª•c ƒë·ª©ng (Visual) */
  .p-stand {
    height: 100px; width: 100%; margin-top: 15px;
    background: linear-gradient(to bottom, #222, #000);
    border-top: 3px solid #444; border-radius: 8px 8px 0 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 3rem; font-weight: 900; color: rgba(255,255,255,0.1);
  }
  .rank-1 .p-stand { height: 140px; border-color: #ffd700; background: linear-gradient(to bottom, #3a2a00, #000); color: rgba(255, 215, 0, 0.2); }
  .rank-2 .p-stand { height: 110px; border-color: #c0c0c0; background: linear-gradient(to bottom, #2a2a2a, #000); }
  .rank-3 .p-stand { height: 80px; border-color: #cd7f32; background: linear-gradient(to bottom, #2a1a10, #000); }

  /* --- 4. LIST TOP 4-10 --- */
  .ranking-list { display: flex; flex-direction: column; gap: 10px; max-width: 800px; margin: 0 auto; }
  
  .rank-row {
    display: flex; align-items: center; padding: 15px 25px;
    background: #111; border: 1px solid #333; border-radius: 8px;
    transition: 0.2s;
  }
  .rank-row:hover { background: #1a1a1a; border-color: #555; transform: scale(1.01); }
  
  .row-rank { font-size: 1.2rem; font-weight: bold; color: #666; width: 50px; }
  .row-name { flex-grow: 1; font-weight: bold; color: #ccc; }
  .row-class { width: 100px; text-align: center; font-size: 0.8rem; color: #888; }
  .row-score { width: 120px; text-align: right; font-family: 'Roboto', sans-serif; color: #ffd700; font-weight: bold; }

  .loading-state { color: #666; font-size: 1.2rem; letter-spacing: 2px; }
</style>

<script>
  // COUNTDOWN
  function updateTimer() {
    const now = new Date();
    const nextSunday = new Date();
    nextSunday.setDate(now.getDate() + (7 - now.getDay()) % 7);
    nextSunday.setHours(23, 59, 59, 0);
    const diff = nextSunday - now;
    if (diff <= 0) return;
    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff % 86400000) / 3600000);
    document.getElementById('season-countdown').innerText = `${d}D ${h}H LEFT`;
  }
  setInterval(updateTimer, 60000); updateTimer();

  // SCROLL FIX
  function preventHorizontalScroll() {
    document.documentElement.style.overflowX = 'hidden';
    document.body.style.overflowX = 'hidden';
  }
  window.addEventListener('load', preventHorizontalScroll);
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, query, orderByChild, limitToLast, get } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBOg7VD7SdFREtVqqBtRcKiGYe-aMUY4mc",
    authDomain: "shopify-e88b6.firebaseapp.com",
    projectId: "shopify-e88b6",
    databaseURL: "https://shopify-e88b6-default-rtdb.asia-southeast1.firebasedatabase.app/" 
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  async function loadLeaderboard() {
    const usersRef = query(ref(db, 'users'), orderByChild('points'), limitToLast(10));
    try {
      const snapshot = await get(usersRef);
      if (snapshot.exists()) {
        const data = snapshot.val();
        let users = Object.values(data).sort((a, b) => b.points - a.points);
        renderLeaderboard(users);
      }
    } catch (error) { console.error(error); }
  }

  function renderLeaderboard(users) {
    const podiumEl = document.getElementById('podium-render');
    const listEl = document.getElementById('ranking-list-render');
    
    let podiumHTML = '';
    let listHTML = '';
    const classes = ['Warrior', 'Mage', 'Archer'];

    users.forEach((user, index) => {
      let rank = index + 1;
      let name = user.name || "Unknown";
      let pts = user.points ? user.points.toLocaleString() : 0;
      let uClass = user.class || classes[Math.floor(Math.random()*3)]; // Demo class
      let classCss = 'class-' + uClass.toLowerCase();

      // --- RENDER TOP 3 (PODIUM) ---
      if (rank <= 3) {
        let reward = rank === 1 ? '50k Gold' : (rank === 2 ? '20k Gold' : '10k Gold');
        let crown = rank === 1 ? '<div class="crown-icon">üëë</div>' : '';
        
        // Avatar Demo (Theo Class)
        let avatarUrl = 'https://cdn-icons-png.flaticon.com/512/149/149071.png'; // Default
        if(uClass == 'Warrior') avatarUrl = 'https://cdn-icons-png.flaticon.com/512/3408/3408593.png';
        if(uClass == 'Mage') avatarUrl = 'https://cdn-icons-png.flaticon.com/512/3408/3408545.png';
        if(uClass == 'Archer') avatarUrl = 'https://cdn-icons-png.flaticon.com/512/3408/3408605.png';

        podiumHTML += `
          <div class="podium-card rank-${rank}">
            ${crown}
            <div class="p-avatar-frame"><img src="${avatarUrl}" class="p-avatar"></div>
            <div class="p-name">${name}</div>
            <div class="p-class ${classCss}">${uClass}</div>
            <div class="p-score">${pts} PTS</div>
            <div class="p-reward">+${reward}</div>
            <div class="p-stand">${rank}</div>
          </div>
        `;
      } 
      // --- RENDER TOP 4-10 (LIST) ---
      else {
        listHTML += `
          <div class="rank-row">
            <div class="row-rank">#${rank}</div>
            <div class="row-name">${name}</div>
            <div class="row-class">${uClass}</div>
            <div class="row-score">${pts}</div>
          </div>
        `;
      }
    });

    podiumEl.innerHTML = podiumHTML;
    listEl.innerHTML = listHTML;
  }
  
  loadLeaderboard();
</script>

{% schema %}
{
  "name": "Leaderboard Olympus V8",
  "settings": [],
  "presets": [{ "name": "Leaderboard Olympus V8" }]
}
{% endschema %}