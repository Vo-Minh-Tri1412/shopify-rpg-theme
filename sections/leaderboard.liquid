{% comment %} 
  V7 GOD MODE: Full Width + Class + Reward + Countdown + Fix Syntax Error
{% endcomment %}

<!-- Container ch√≠nh -->
<div class="leaderboard-god-mode-wrapper">
  <div class="leaderboard-inner-content">
    
    <div class="header-wrapper">
      <h2 class="leaderboard-title">üèÜ LEGENDARY RANKING üèÜ</h2>
      <p class="leaderboard-subtitle">Season ends in: <span id="season-countdown" style="color:#ff4d4d; font-weight:bold;">Loading...</span></p>
      
      <div class="reward-info">
        <span>ü•á Top 1: <b style="color:#ffd700">50,000 Gold</b></span> ‚Ä¢ 
        <span>ü•à Top 2: <b style="color:#c0c0c0">20,000 Gold</b></span> ‚Ä¢ 
        <span>ü•â Top 3: <b style="color:#cd7f32">10,000 Gold</b></span>
      </div>
    </div>
    
    <table id="leaderboard-table">
      <thead>
        <tr>
          <th style="width: 15%;">RANK</th>
          <th style="width: 35%;">NAME</th>
          <th style="width: 20%;">CLASS</th>
          <th style="width: 30%;">POINTS</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4" class="loading-text">Summoning Data...</td></tr>
      </tbody>
    </table>

  </div>
</div>

<style>
  /* 1. LAYOUT FULL WIDTH */
  .leaderboard-god-mode-wrapper {
    width: 100vw !important; 
    position: relative !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    background-color: #0a0a0c;
    color: #ffffff;
    padding: 60px 0;
    font-family: 'Cinzel', serif; /* Font game */
  }

  .leaderboard-inner-content {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
    text-align: center;
  }

  .leaderboard-title {
    color: #FFD700; 
    font-size: 2.5rem;
    font-weight: 800;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    margin: 0;
  }
  .leaderboard-subtitle { color: #aaa; margin-top: 10px; font-family: sans-serif; font-size: 14px; }
  
  .reward-info {
    margin-top: 15px;
    padding: 10px;
    background: rgba(255,255,255,0.05);
    border: 1px solid #333;
    display: inline-block;
    border-radius: 50px;
    font-size: 13px;
  }

  table { 
    width: 100%; 
    border-collapse: separate; 
    border-spacing: 0;
    background-color: #111; 
    border-radius: 12px;
    border: 2px solid #333;
    overflow: hidden;
    margin-top: 40px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  }

  th { background-color: #1a1a1a; color: #888; padding: 20px; border-bottom: 2px solid #444; font-size: 12px; letter-spacing: 2px; }
  td { padding: 18px; border-bottom: 1px solid #222; color: #ddd; text-align: center; font-family: sans-serif; font-weight: 500; }
  
  /* Class Colors */
  .class-warrior { color: #ff4d4d !important; font-weight: bold; }
  .class-mage { color: #a335ee !important; font-weight: bold; }
  .class-archer { color: #2ecc71 !important; font-weight: bold; }

  /* Top 3 Styles */
  tr.rank-1 td { background: linear-gradient(90deg, rgba(255,215,0,0.1), transparent); border-bottom: 1px solid #ffd700; color: #fff; }
  tr.rank-1 .rank-icon { font-size: 1.5em; text-shadow: 0 0 10px gold; }
  
  tr.rank-2 td { background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent); }
  tr.rank-3 td { background: linear-gradient(90deg, rgba(205,127,50,0.05), transparent); }

  .loading-text { font-style: italic; color: #666; padding: 50px; }
</style>

<script>
  // --- COUNTDOWN LOGIC (Reset Ch·ªß Nh·∫≠t) ---
  function updateTimer() {
    const now = new Date();
    const nextSunday = new Date();
    nextSunday.setDate(now.getDate() + (7 - now.getDay()) % 7);
    nextSunday.setHours(23, 59, 59, 0); // 23:59:59 Ch·ªß nh·∫≠t

    const diff = nextSunday - now;
    if (diff <= 0) {
      document.getElementById('season-countdown').innerText = "SEASON ENDED";
      return;
    }

    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
    const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    
    document.getElementById('season-countdown').innerText = `${d}d ${h}h ${m}m`;
  }
  setInterval(updateTimer, 60000); // Update m·ªói ph√∫t
  updateTimer();

  // --- PREVENT SCROLL ---
  function preventHorizontalScroll() {
    document.documentElement.style.overflowX = 'hidden';
    document.body.style.overflowX = 'hidden';
  }
  window.addEventListener('load', preventHorizontalScroll);
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, query, orderByChild, limitToLast, get } 
    from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBOg7VD7SdFREtVqqBtRcKiGYe-aMUY4mc",
    authDomain: "shopify-e88b6.firebaseapp.com",
    projectId: "shopify-e88b6",
    databaseURL: "https://shopify-e88b6-default-rtdb.asia-southeast1.firebasedatabase.app/" 
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  async function loadLeaderboard() {
    const usersRef = query(ref(db, 'users'), orderByChild('points'), limitToLast(10));
    try {
      const snapshot = await get(usersRef);
      if (snapshot.exists()) {
        const data = snapshot.val();
        let leaderboard = Object.values(data).sort((a, b) => b.points - a.points);
        renderTable(leaderboard);
      } else {
        document.querySelector('#leaderboard-table tbody').innerHTML = "<tr><td colspan='4' class='loading-text'>No warriors found.<\/td><\/tr>";
      }
    } catch (error) {
      console.error(error);
      document.querySelector('#leaderboard-table tbody').innerHTML = "<tr><td colspan='4' class='error-text'>Server Error<\/td><\/tr>";
    }
  }

  function renderTable(users) {
    let html = '';
    users.forEach((user, index) => {
      let rank = index + 1;
      let name = user.name || "Unknown Hero";
      let points = user.points ? user.points.toLocaleString() : 0;
      
      const classes = ['Warrior', 'Mage', 'Archer'];
      let userClass = user.class || classes[Math.floor(Math.random() * classes.length)];
      let classCss = 'class-' + userClass.toLowerCase();

      let rankDisplay = `<span class="rank-num">#${rank}</span>`;
      let rewardText = "";

      if (rank === 1) { 
        rankDisplay = '<span class="rank-icon">ü•á</span>'; 
        rewardText = '<br><span style="font-size:10px; color:#ffd700;">+50k Gold</span>';
      }
      else if (rank === 2) {
        rankDisplay = '<span class="rank-icon">ü•à</span>';
        rewardText = '<br><span style="font-size:10px; color:#c0c0c0;">+20k Gold</span>';
      }
      else if (rank === 3) {
        rankDisplay = '<span class="rank-icon">ü•â</span>';
        rewardText = '<br><span style="font-size:10px; color:#cd7f32;">+10k Gold</span>';
      }
      
      html += `
        <tr class="rank-${rank}">
          <td>${rankDisplay}</td>
          <td style="font-weight:bold;">${name} ${rewardText}</td>
          <td class="${classCss}">${userClass.toUpperCase()}</td>
          <td>${points} pts</td>
        <\/tr>
      `;
    });
    document.querySelector('#leaderboard-table tbody').innerHTML = html;
  }
  
  loadLeaderboard();
</script>

{% schema %}
{
  "name": "Leaderboard God Mode V7",
  "tag": "section",
  "class": "section",
  "settings": [],
  "presets": [{ "name": "Leaderboard God Mode V7" }]
}
{% endschema %}