{% comment %}
  LOOTBOX PURCHASE HANDLER
  Include this in checkout success page or use Shopify Flow/Webhook
  When customer purchases lootbox, it will be added to inventory
{% endcomment %}

<script>
  // This function is called when lootbox purchase is successful
  // Needs to be triggered from Shopify webhook or thank you page
  
  function processLootboxPurchase(orderData) {
    // orderData contains order information
    // Check if there's a lootbox in the order
    
    if (!orderData || !orderData.line_items) return;
    
    orderData.line_items.forEach(item => {
      // Check if product is lootbox (based on tag or product_type)
      if (item.product_type === 'lootbox' || (item.tags && item.tags.includes('lootbox'))) {
        // Add to inventory
        const lootboxData = {
          name: item.title,
          image: item.image || '',
          variantId: item.variant_id,
          lootTable: item.lootTable || [] // Need to get from metafield
        };
        
        if (typeof addLootboxToInventory === 'function') {
          addLootboxToInventory(lootboxData);
        }
      }
    });
  }
</script>
